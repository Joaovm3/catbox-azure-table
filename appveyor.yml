# appveyor file
# http://www.appveyor.com/docs/appveyor-yml

environment:
  matrix:
    - nodejs_version: 0.10
  CODECLIMATE_REPO_TOKEN:
    secure: +dPx4KAE5xmYZBHquqBpuUnc5Rc/GKpydqfpst4eGfAD8MSTW+1Vuru+6QSnZVHMOi1ZlPZ5eK6QIP/7JpIMYr1VB92p/MifAWK0HHQODus=
  TERM: msys

install:
  - ps: Update-NodeJsInstallation (Get-NodeJsLatestBuild $env:nodejs_version)
  - npm install -g codeclimate-test-reporter
  - npm install

build: off

before_test:
  - ps: '& "${Env:ProgramFiles(x86)}\Microsoft SDKs\Azure\Storage Emulator\WAStorageEmulator.exe" start'

test_script:
  - node --version
  - npm --version
  - npm test

after_test:
  - git checkout -qf master
  - git status
  - ps: 'git log -1 --pretty=format:"%H"'
  - ps: 'git log -1 --pretty=format:"%ct"'
  - ps: '$env:JENKINS_URL=”true”'
  - ps: '$env:GIT_BRANCH=”master”'
  - ps: '$env:GIT_COMMIT=”${Env:APPVEYOR_REPO_COMMIT}”'
  - codeclimate < coverage.lcov